#@base /_html.pt
#@import /_blocks/nav_blocks.pt

@body[]
  ^header[]
  <div class="container">
    <h1>$title</h1>
    <div class="row">
      <div class="col-md-8">
        ^save_form[$formData;
          $.action[^linkTo[/]]
          $.error[$error]
        ]
      </div>
      <div class="secret-form-description col-md-4 hidden-xs-down">
        <p>Введите секретное сообщение и пин-код. Укажите сколько минут сообщение доступно получателю. Секретную ссылку перешлите коллеге по почте или через чат. Пин-код расскажите по телефону или пошлите эсэмэской. Коллега откроет сайт по ссылке, введет пин-код и увидит сообщение. Сообщение покажем один раз и сразу сотрем из базы данных.</p>
#         <p class="hidden-sm-down">Не отправляйте ссылку и пин-код в двух письмах по электронной почте или двумя сообщениями в одном и том же чате.</p>
      </div>
    </div>
    <div class="row about">
      <div class="col-md-8">
        <p>Сайт помогает пользователям передавать секретные сообщения коллегам и друзьям через интернет. Сообщение защищаем пин-кодом и уничтожаем как только получатель откроет ссылку и введет правильный пин-код.</p>
      </div>
    </div>
  </div>

  ^footer[]

@save_form[aFormData;aOptions]
## aOptions.action[]
## aOptions.error
  ^cleanMethodArgument[aFormData;aOptions]
  <form action="$aOptions.action" method="post" class="message-form form-default">
    <div class="form-group ^if($aOptions.error.type eq "core.messages.empty.data"){has-danger}">
      <textarea name="data" id="f-data" class="form-control" rows="6" placeholder="Тест сообщения" />$aFormData.data</textarea>
      ^if($aOptions.error.type eq "core.messages.empty.data"){
        <div class="form-control-feedback">$aOptions.error.message</div>
      }
    </div>

    <div class="form-group ^if($aOptions.error.type eq "core.messages.invalid.pin"){has-danger}">
      <label for="f-pinHash" class="form-control-label">Пин-код</label>
      <div class="row">
        <div class="col-sm-7">
          <div class="input-group">
            <input type="text" name="pinHash" id="f-pinHash" value="$aFormData.pinHash" class="form-control" placeholder="" />
          </div>
        </div>
      </div>
      ^if($aOptions.error.type eq "core.messages.invalid.pin"){
        <div class="form-control-feedback">$aOptions.error.message</div>
      }
    </div>

    <div class="form-group">
      <label for="f-expiredAt" class="form-control-label">Время жизни сообщения</label>
      <div class="row">
        <div class="col-sm-5">
          <div class="input-group">
            <input type="text" name="expiredAt" id="f-expiredAt" value="$aFormData.expiredAt" class="form-control" placeholder="$CONTROLLER.conf.defaultMessageTTL" />
            <span class="input-group-addon">минут</span>
          </div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <input type="submit" id="f-sub" value="Сохранить" class="btn btn-primary" />
    </div>
  </form>

  <script>
    ^$(function(){
      validator.check_form(['#f-data', '#f-pinHash'], ['#f-sub'])
      ^$('.message-form').on('submit', function(e){
        ^$('#f-sub').attr('disabled', '')^;
      })^;
    });
  </script>
