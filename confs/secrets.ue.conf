<VirtualHost *:443>
    ServerName secrets.unhandled-exception.ru
    ServerAlias www.secrets.unhandled-exception.ru
    ServerAdmin oleg@volchkov.net
    DocumentRoot /home/pf2secrets/secrets.unhandled-exception.ru/app/public/site/

    ErrorLog /home/pf2secrets/secrets.unhandled-exception.ru/logs/secrets.unhandled-exception.ru.443.error
    CustomLog /home/pf2secrets/secrets.unhandled-exception.ru/logs/secrets.unhandled-exception.ru.443.access combined

    SuexecUserGroup pf2secrets pf2secrets
    ScriptAlias   /cgi-bin/ /home/pf2secrets/secrets.unhandled-exception.ru/cgi-bin/

    <Directory /home/pf2secrets/secrets.unhandled-exception.ru/app/public/*>
        Allow from all

        Options -Indexes +Includes +FollowSymLinks +ExecCGI
        AllowOverride None

        AddHandler parser3-handler html
        Action parser3-handler /cgi-bin/parser3.cgi

        <Files ~ "\.p$">
           Require all denied
        </Files>

        AddCharset UTF-8 .css
        AddCharset UTF-8 .htm

        DirectorySlash Off

#        ErrorDocument 403 /403.htm
        ErrorDocument 401 /500.htm
        ErrorDocument 500 /500.htm

        ExpiresActive On
        ExpiresDefault "access plus 1 years"
    </Directory>

    <Directory /home/pf2secrets/secrets.unhandled-exception.ru/cgi-bin>
        Allow from all

        <Files ~ "\.p$">
            Require all denied
        </Files>
        SSLOptions +StdEnvVars
    </Directory>

    <Directory "/home/pf2secrets/secrets.unhandled-exception.ru/app/public/site">
        RewriteEngine On
        RewriteBase /

        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_URI} !^/server-(status|info)/?
        RewriteRule ^(.*)$ /_ind.html?_action=$1 [QSA,L]

        Allow from all
   </Directory>

   SSLEngine on
   SSLCipherSuite HIGH:MEDIUM
   SSLOptions +OptRenegotiate
   SSLCertificateFile /usr/local/etc/dehydrated/certs/secrets.unhandled-exception.ru/cert.pem
   SSLCertificateKeyFile /usr/local/etc/dehydrated/certs/secrets.unhandled-exception.ru/privkey.pem
   SSLCACertificateFile /usr/local/etc/dehydrated/certs/secrets.unhandled-exception.ru/fullchain.pem
</VirtualHost>

<VirtualHost *:80>
    ServerName secrets.unhandled-exception.ru
    ServerAlias www.secrets.unhandled-exception.ru
    ServerAdmin oleg@volchkov.net
    DocumentRoot /home/pf2secrets/secrets.unhandled-exception.ru/app/public/site/

    ErrorLog /home/pf2secrets/secrets.unhandled-exception.ru/logs/secrets.unhandled-exception.ru.80.error
    CustomLog /home/pf2secrets/secrets.unhandled-exception.ru/logs/secrets.unhandled-exception.ru.80.access combined

    SuexecuserGroup pf2secrets pf2secrets

    <Directory "/home/pf2secrets/secrets.unhandled-exception.ru/app/public/site">
        Allow from all

        RewriteEngine On
        RewriteBase /
        RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [L,R=301]
   </Directory>
</VirtualHost>
