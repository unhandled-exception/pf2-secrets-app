# pf2-secrets-app

Пример приложения на PF2. Не хочу делать очередной блог. Напишем клон проекта https://github.com/umputun/secrets для секретного обмена сообщениями через инет. Оригинал написан на Go. Напишем приложение на Парсере с фреймворком pf2.

Сайт помогает пользователям безопасно передавать сообщения коллегам и друзьям. Сообщение защищаем пин-кодом и уничтожаем как только получатель откроет ссылку и введет правильный пин-код.

## Принцип работы

Вводите на сайте секретное сообщение и пин-код. Указываете сколько минут сообщение будет доступно получателю. Секретную ссылку пересылаем коллеге по почте или через чат. Пин-код передадим скажем по телефону или пошлем эсэмэской. Не отправляйте ссылку и пин-код в двух письмах по электронной почте или двумя сообщениями в одном и том же чате.

Коллега откроет сайт по ссылке, введет пин-код и увидит сообщение. Сообщение покажем один раз и сразу сотрем из базы данных.

## Безопасность

* Шифруем сообщение пин-кодом перед тем как сохранить в базу данных. Для пин-кода храним хеш из которого невозможно восстановить пин.
* Не сохраняем сообщения и пин-коды в логи веб-сервера.
* Сообщение удалим сразу после просмотра получателем. Спрашиваем сколько минут хранить сообщение. Удалим сообщение, когда время прошло и сообщение не прочитали.

## API

Сайт предоставляет простое REST API для сохранения и загрузки сообщений.

### Save message

`POST /v1/message`, body - `{"message":"some top secret info", "exp": 15, "pin": "12345"}`
- `exp` expire in N minutes
- `pin` fixed-size pin code

```
    $ http POST https://secrets.unhandled-exception.ru/api/v1/message pin=12345 message=testtest-12345678 exp=15

    HTTP/1.1 201 Created

    {
     "exp": "2016-06-25T13:33:45.11847278-05:00",
     "token": "f1acfe04-277f-4016-518d-16c312ab84b5"
    }
```

### Load message

`GET /v1/message/:token/:pin`

```
    $ http GET https://secrets.unhandled-exception.ru/api/v1/message/6ceab760-3059-4a52-5670-649509b128fc/12345

    HTTP/1.1 200 OK

    {
     "token": "6ceab760-3059-4a52-5670-649509b128fc",
     "message": "testtest-12345678"
    }
```

### ping

`GET /v1/ping`

```
    $ http https://secrets.unhandled-exception.ru/api/v1/ping

    HTTP/1.1 200 OK

    pong
```

### Get params

`GET /v1/params`

```
    $ http https://secrets.unhandled-exception.ru/api/v1/params

    HTTP/1.1 200 OK

    {
        "max_exp_min": 15,
        "max_pin_attempts": 3,
        "min_pin_size": 5
    }
```
